# Daphnia Article

This repository contains the necessary code to reproduce the article: *Mechanistic models for panel data: Analysis of ecological experiments with four interacting species*.

## Compile MS

The manuscript is self-contained and can be generated by knitting the `./daphnia-article/ms.Rnw` file.

**Note:** The majority of expensive computations are done in separate `R` scripts in another repository, but there are a few calculations (including simulation and pomp object creation) that occur within `ms.Rnw`.

You can knit the file in multiple ways; for example, to run it on a cluster:
```
cd ./daphnia-article && Rscript -e "library(knitr); knit2pdf('./ms.Rnw')"
```

## Compile SI 

The supplementary material in `./daphnia-article/si/si.Rnw` is **independent** of the main manuscript. To compile all supplementary `.Rnw` files, you can do the following in the si folder:
```
cd ./daphnia-article/si && Rscript -e "library(knitr); knit2pdf('./si.Rnw')"
```


## Analysis Pipeline
1. **Clone** this repository and set it as your working directory.

2. **Data**:  
   - The file `./Mesocosmdata.xls` contains three sheets:
     - **Sheet 1**: Daphnia dentifera dynamics with/without parasite  
     - **Sheet 2**: Daphnia lumholtzi dynamics with/without parasite  
     - **Sheet 3**: Mixed Daphnia dentifera and lumholtzi dynamics with/without parasite  
   - Refer to Section 2 in `./daphnia-article/ms.pdf` for data description, and Sections S3â€“S6 in `./daphnia-article/si.pdf` for supplementary details.

3. **Model Fitting**:
   - Various mechanistic models are fit under the `panelPOMP` framework. For the mixed-species SIRJPF2 model, see `./Mixed-species/SIRJPF2`, which includes:
     - **model**: Parameter estimation scripts. The `run level` indicates computational intensity:
       - Level 1: Debug
       - Level 2: Local computation (~1 hour on 36 cores, ~50 GB memory)
       - Level 3: Accurate parameter estimation (higher computational demands) (~40 hour on 36 cores, ~50 GB memory)
     - **profile**: Parameter profiling scripts (MCAP algorithm). We provide profile structure within this repository, while detailed adjustments are needed depend on the situation. Further adjustment instruction will be provided in the tutorial file.
     - **specific_model**: Scripts for parameter estimation allowing certain parameters to be unit-specific (using `mif2`).
     - **specific_model_block**: Similar to `specific_model` but uses blocking with `mif2`.
   - Other models are found in:
     - SRJF2: `./Mixed-species/SRJF2`
     - SIRJPF (Daphnia dentifera): `./Single-species/Dent/SIRJPF`
     - SIRJPF (Daphnia lumholtzi): `./Single-species/Lum/SIRJPF`
     - SRJF (Daphnia dentifera): `./Single-species/Dent/SRJF`
     - SRJF (Daphnia lumholtzi): `./Single-species/Lum/SRJF`

4. **Results**:
   - After parameter estimation and profiling, use scripts in `./util` to generate profiling plots, simulations, and parameter-estimation tables for the main article and supplementary materials.

